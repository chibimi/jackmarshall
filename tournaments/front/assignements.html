<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>JackMarshall</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css" >

    <script src="bower_components/jquery/dist/jquery.min.js"></script>

</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <h1 class="text-center">Table Assignments <small id="round-number"></small></h1>
        </div>
        <div class="row">
            <div class="col-xs-4">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Table</th>
                            <th>P1</th>
                            <th>P2</th>
                        </tr>
                    </thead>
                    <tbody id="t1">

                    </tbody>
                </table>
            </div>
            <div class="col-xs-4">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Table</th>
                            <th>P1</th>
                            <th>P2</th>
                        </tr>
                    </thead>
                    <tbody id="t2">

                    </tbody>
                </table>
            </div>
            <div class="col-xs-4">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Table</th>
                            <th>P1</th>
                            <th>P2</th>
                        </tr>
                    </thead>
                    <tbody id="t3">

                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>

    function getParameterByName(name, url) {
        if (!url) {
            url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function compare(a,b) {
        if (a.table.name < b.table.name)
        return -1;
        if (a.table.name > b.table.name)
        return 1;
        return 0;
    }


    $(document).ready(function(){

        jQuery.support.cors = true;

        id = getParameterByName('id');
        $.getJSON("/api/tournaments/"+id, function( data ) {

            var table = ["","",""];
            var round = data.rounds[data.rounds.length-1];
            round.games.sort(compare)

            var maxsize = round.games.length/3;

            for (var i = 0; i < round.games.length; i++){
                table[Math.floor(i/maxsize)] += '<tr><td>' + round.games[i].table.name + '</td><td>' + round.games[i].results[0].player.name + '</td><td>' + round.games[i].results[1].player.name + '</td></tr>';
            }

            $('#t1').append(table[0]);
            $('#t2').append(table[1]);
            $('#t3').append(table[2]);
            $('#round-number').append("Ronde "+(round.number+1));

        });

    })

    </script>

</body>
</html>
